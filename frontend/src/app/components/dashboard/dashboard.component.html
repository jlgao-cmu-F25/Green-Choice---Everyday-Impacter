<app-header/>
<div class="container">
  @if (loading) {
    <div class="loading">Loading...</div>
  }

  @if (!loading) {
    <div>
      <!-- Navigation to Leaderboard -->
      <div class="impact-card leaderboard-nav">
        <h3>üèÜ Leaderboard</h3>
        <p>See how you rank against other eco-warriors!</p>
        <button class="leaderboard-button" (click)="navigateToLeaderboard()">
          View Leaderboard ‚Üí
        </button>
      </div>
      
      <!-- Action Buttons -->
      <div class="actions-section">
        <h2>Log Your Eco-Actions</h2>
        <div class="action-grid">
          @for (action of ecoActions; track action) {
            <button
              class="action-button"
              (click)="logAction(action)">
              <span class="action-icon">{{ action.icon }}</span>
              <span class="action-name">{{ action.name }}</span>
              <span class="action-impact">-{{ action.co2Saved }} kg CO‚ÇÇ</span>
            </button>
          }
        </div>
      </div>
      <!-- Total Impact -->
      @if (userStats) {
        <div class="total-impact">
          <h3>All-Time Impact</h3>
          <div class="total-stats">
            <div class="total-stat">
              <div class="total-value">{{ userStats.totalCO2Saved.toFixed(2) }}</div>
              <div class="total-label">kg CO‚ÇÇ saved</div>
            </div>
            <div class="total-stat">
              <div class="total-value">{{ userStats.totalWaterSaved.toFixed(1) }}</div>
              <div class="total-label">Liters water saved</div>
            </div>
            <div class="total-stat">
              <div class="total-value">{{ userStats.totalWasteSaved.toFixed(2) }}</div>
              <div class="total-label">kg waste reduced</div>
            </div>
          </div>
        </div>
      }
      
      <!-- Trees Saved Section -->
      @if (userStats && userStats.totalCO2Saved > 0) {
        <div class="trees-saved-section">
          <div class="trees-hero">
            <div class="trees-animation">
              <span class="tree">üå≤</span>
              <span class="tree">üå≥</span>
              <span class="tree">üåø</span>
              <span class="tree">üå±</span>
            </div>
            <h2 class="trees-title">CO2s you saved is equivalent to: </h2>
            <div class="trees-count">
              <span class="trees-number">{{ calculateTreesSaved(userStats.totalCO2Saved).toFixed(1) }}</span>
              <span class="trees-label">Tree Equivalents</span>
            </div>
            <p class="trees-message">{{ getTreesMessage(calculateTreesSaved(userStats.totalCO2Saved)) }}</p>
            <div class="trees-explanation">
              <p>Based on the fact that an average tree absorbs ~22kg of CO‚ÇÇ per year</p>
            </div>
          </div>
        </div>
      }
      
      <!-- Streak Display -->
      @if (userStats) {
        <div class="streak-card">
          <div class="streak-info">
            <div class="streak-item">
              <span class="streak-emoji">üî•</span>
              <div>
                <div class="streak-number">{{ userStats.currentStreak }}</div>
                <div class="streak-label">Day Streak</div>
              </div>
            </div>
            <div class="streak-item">
              <span class="streak-emoji">üèÜ</span>
              <div>
                <div class="streak-number">{{ userStats.longestStreak }}</div>
                <div class="streak-label">Best Streak</div>
              </div>
            </div>
          </div>
        </div>
      }
      
      <!-- Beautiful Bottom Impact Journey -->
      <div class="bottom-impact-journey">
        <div class="journey-header">
          <h2 class="journey-title">üìä Your Environmental Journey</h2>
          <p class="journey-subtitle">Track your daily and weekly progress</p>
        </div>
        
        <div class="impact-timeline">
          <!-- Today's Impact Card -->
          <div class="timeline-card today-card">
            <div class="card-header">
              <div class="header-left">
                <span class="period-icon">‚òÄÔ∏è</span>
                <div class="header-text">
                  <h3>Today's Impact</h3>
                  <span class="period-badge">Last 24 Hours</span>
                </div>
              </div>
              <div class="progress-ring">
                <div class="ring-progress" [style.--progress]="getProgressPercentage(todayImpact.co2, weekImpact.co2)"></div>
                <span class="progress-text">{{ getProgressPercentage(todayImpact.co2, weekImpact.co2) }}%</span>
              </div>
            </div>
            
            <div class="impact-metrics">
              <div class="metric-item co2-metric">
                <div class="metric-visual">
                  <span class="metric-icon">üí®</span>
                  <div class="metric-bar">
                    <div class="bar-fill co2-fill" [style.width.%]="getProgressPercentage(todayImpact.co2, weekImpact.co2)"></div>
                  </div>
                </div>
                <div class="metric-content">
                  <span class="metric-value">{{ todayImpact.co2.toFixed(2) }}</span>
                  <span class="metric-unit">kg CO‚ÇÇ</span>
                  <span class="metric-label">Saved Today</span>
                </div>
              </div>
              
              <div class="metric-item water-metric">
                <div class="metric-visual">
                  <span class="metric-icon">üíß</span>
                  <div class="metric-bar">
                    <div class="bar-fill water-fill" [style.width.%]="getProgressPercentage(todayImpact.water, weekImpact.water)"></div>
                  </div>
                </div>
                <div class="metric-content">
                  <span class="metric-value">{{ todayImpact.water.toFixed(1) }}</span>
                  <span class="metric-unit">L Water</span>
                  <span class="metric-label">Conserved</span>
                </div>
              </div>
              
              <div class="metric-item waste-metric">
                <div class="metric-visual">
                  <span class="metric-icon">‚ôªÔ∏è</span>
                  <div class="metric-bar">
                    <div class="bar-fill waste-fill" [style.width.%]="getProgressPercentage(todayImpact.waste, weekImpact.waste)"></div>
                  </div>
                </div>
                <div class="metric-content">
                  <span class="metric-value">{{ todayImpact.waste.toFixed(2) }}</span>
                  <span class="metric-unit">kg Waste</span>
                  <span class="metric-label">Reduced</span>
                </div>
              </div>
            </div>
          </div>
          
          <!-- This Week's Impact Card -->
          <div class="timeline-card week-card">
            <div class="card-header">
              <div class="header-left">
                <span class="period-icon">üìÖ</span>
                <div class="header-text">
                  <h3>This Week's Impact</h3>
                  <span class="period-badge">7 Days Total</span>
                </div>
              </div>
              <div class="achievement-badge">
                <span class="badge-icon">üèÖ</span>
                <span class="badge-text">Weekly</span>
              </div>
            </div>
            
            <div class="impact-metrics">
              <div class="metric-item co2-metric">
                <div class="metric-visual">
                  <span class="metric-icon">üí®</span>
                  <div class="metric-bar full-bar">
                    <div class="bar-fill co2-fill-full"></div>
                  </div>
                </div>
                <div class="metric-content">
                  <span class="metric-value">{{ weekImpact.co2.toFixed(2) }}</span>
                  <span class="metric-unit">kg CO‚ÇÇ</span>
                  <span class="metric-label">Total This Week</span>
                </div>
              </div>
              
              <div class="metric-item water-metric">
                <div class="metric-visual">
                  <span class="metric-icon">üíß</span>
                  <div class="metric-bar full-bar">
                    <div class="bar-fill water-fill-full"></div>
                  </div>
                </div>
                <div class="metric-content">
                  <span class="metric-value">{{ weekImpact.water.toFixed(1) }}</span>
                  <span class="metric-unit">L Water</span>
                  <span class="metric-label">Total This Week</span>
                </div>
              </div>
              
              <div class="metric-item waste-metric">
                <div class="metric-visual">
                  <span class="metric-icon">‚ôªÔ∏è</span>
                  <div class="metric-bar full-bar">
                    <div class="bar-fill waste-fill-full"></div>
                  </div>
                </div>
                <div class="metric-content">
                  <span class="metric-value">{{ weekImpact.waste.toFixed(2) }}</span>
                  <span class="metric-unit">kg Waste</span>
                  <span class="metric-label">Total This Week</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Weekly Insights Section -->
        @if (insights.length > 0) {
          <div class="insights-showcase">
            <div class="insights-header">
              <span class="insights-icon">üí°</span>
              <h3>Weekly Insights & Achievements</h3>
              <div class="insights-count">{{ insights.length }}</div>
            </div>
            <div class="insights-container">
              @for (insight of insights; track insight; let i = $index) {
                <div class="insight-card" [style.animation-delay]="i * 0.1 + 's'">
                  <span class="insight-number">{{ i + 1 }}</span>
                  <div class="insight-content">
                    <span class="insight-sparkle">‚ú®</span>
                    <p class="insight-text">{{ insight }}</p>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>
