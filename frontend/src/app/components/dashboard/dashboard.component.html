<app-header/>
<div class="container">
  @if (loading) {
    <div class="loading">Loading...</div>
  }

  @if (!loading) {
    <div>
      <!-- Streak Display -->
      @if (userStats) {
        <div class="streak-card">
          <div class="streak-info">
            <div class="streak-item">
              <span class="streak-emoji">ğŸ”¥</span>
              <div>
                <div class="streak-number">{{ userStats.currentStreak }}</div>
                <div class="streak-label">Day Streak</div>
              </div>
            </div>
            <div class="streak-item">
              <span class="streak-emoji">ğŸ†</span>
              <div>
                <div class="streak-number">{{ userStats.longestStreak }}</div>
                <div class="streak-label">Best Streak</div>
              </div>
            </div>
          </div>
        </div>
      }
      <!-- Impact Summary -->
      <div class="impact-grid">
        <div class="impact-card">
          <h3>Today's Impact</h3>
          <div class="impact-stats">
            <div class="stat">
              <span class="stat-icon">ğŸ’¨</span>
              <span class="stat-value">{{ todayImpact.co2.toFixed(2) }} kg</span>
              <span class="stat-label">COâ‚‚ Saved</span>
            </div>
            <div class="stat">
              <span class="stat-icon">ğŸ’§</span>
              <span class="stat-value">{{ todayImpact.water.toFixed(1) }} L</span>
              <span class="stat-label">Water Saved</span>
            </div>
            <div class="stat">
              <span class="stat-icon">â™»ï¸</span>
              <span class="stat-value">{{ todayImpact.waste.toFixed(2) }} kg</span>
              <span class="stat-label">Waste Reduced</span>
            </div>
          </div>
        </div>
        <div class="impact-card">
          <h3>This Week</h3>
          <div class="impact-stats">
            <div class="stat">
              <span class="stat-icon">ğŸ’¨</span>
              <span class="stat-value">{{ weekImpact.co2.toFixed(2) }} kg</span>
              <span class="stat-label">COâ‚‚ Saved</span>
            </div>
            <div class="stat">
              <span class="stat-icon">ğŸ’§</span>
              <span class="stat-value">{{ weekImpact.water.toFixed(1) }} L</span>
              <span class="stat-label">Water Saved</span>
            </div>
            <div class="stat">
              <span class="stat-icon">â™»ï¸</span>
              <span class="stat-value">{{ weekImpact.waste.toFixed(2) }} kg</span>
              <span class="stat-label">Waste Reduced</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Insights -->
      @if (insights.length > 0) {
        <div class="insights-card">
          <h3>ğŸ’¡ Your Impact This Week</h3>
          <ul class="insights-list">
            @for (insight of insights; track insight) {
              <li>{{ insight }}</li>
            }
          </ul>
        </div>
      }
      
      <!-- Navigation to Leaderboard -->
      <div class="impact-card leaderboard-nav">
        <h3>ğŸ† Leaderboard</h3>
        <p>See how you rank against other eco-warriors!</p>
        <button class="leaderboard-button" (click)="navigateToLeaderboard()">
          View Leaderboard â†’
        </button>
      </div>
      
      <!-- Action Buttons -->
      <div class="actions-section">
        <h2>Log Your Eco-Actions</h2>
        <div class="action-grid">
          @for (action of ecoActions; track action) {
            <button
              class="action-button"
              (click)="logAction(action)">
              <span class="action-icon">{{ action.icon }}</span>
              <span class="action-name">{{ action.name }}</span>
              <span class="action-impact">-{{ action.co2Saved }} kg COâ‚‚</span>
            </button>
          }
        </div>
      </div>
      <!-- Total Impact -->
      @if (userStats) {
        <div class="total-impact">
          <h3>All-Time Impact</h3>
          <div class="total-stats">
            <div class="total-stat">
              <div class="total-value">{{ userStats.totalCO2Saved.toFixed(2) }}</div>
              <div class="total-label">kg COâ‚‚ saved</div>
            </div>
            <div class="total-stat">
              <div class="total-value">{{ userStats.totalWaterSaved.toFixed(1) }}</div>
              <div class="total-label">Liters water saved</div>
            </div>
            <div class="total-stat">
              <div class="total-value">{{ userStats.totalWasteSaved.toFixed(2) }}</div>
              <div class="total-label">kg waste reduced</div>
            </div>
          </div>
        </div>
      }
      
      <!-- Trees Saved Section -->
      @if (userStats && userStats.totalCO2Saved > 0) {
        <div class="trees-saved-section">
          <div class="trees-hero">
            <div class="trees-animation">
              <span class="tree">ğŸŒ²</span>
              <span class="tree">ğŸŒ³</span>
              <span class="tree">ğŸŒ¿</span>
              <span class="tree">ğŸŒ±</span>
            </div>
            <h2 class="trees-title">CO2s you saved is equivalent to: </h2>
            <div class="trees-count">
              <span class="trees-number">{{ calculateTreesSaved(userStats.totalCO2Saved).toFixed(1) }}</span>
              <span class="trees-label">Tree Equivalents</span>
            </div>
            <p class="trees-message">{{ getTreesMessage(calculateTreesSaved(userStats.totalCO2Saved)) }}</p>
            <div class="trees-explanation">
              <p>Based on the fact that an average tree absorbs ~22kg of COâ‚‚ per year</p>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>
